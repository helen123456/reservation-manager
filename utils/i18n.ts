import AsyncStorage from "@react-native-async-storage/async-storage";
import { Platform } from "react-native";

// Cross-platform storage utility
const storage = {
  async getItem(key: string): Promise<string | null> {
    if (Platform.OS === "web") {
      try {
        return typeof window !== "undefined" && window.localStorage
          ? window.localStorage.getItem(key)
          : null;
      } catch (error) {
        console.warn("Storage getItem error:", error);
        return null;
      }
    }
    try {
      return await AsyncStorage.getItem(key);
    } catch (error) {
      console.warn("AsyncStorage getItem error:", error);
      return null;
    }
  },

  async setItem(key: string, value: string): Promise<void> {
    if (Platform.OS === "web") {
      try {
        if (typeof window !== "undefined" && window.localStorage) {
          window.localStorage.setItem(key, value);
        }
      } catch (error) {
        console.warn("Storage setItem error:", error);
      }
      return;
    }
    try {
      return await AsyncStorage.setItem(key, value);
    } catch (error) {
      console.warn("AsyncStorage setItem error:", error);
    }
  },

  async removeItem(key: string): Promise<void> {
    if (Platform.OS === "web") {
      try {
        if (typeof window !== "undefined" && window.localStorage) {
          window.localStorage.removeItem(key);
        }
      } catch (error) {
        console.warn("Storage removeItem error:", error);
      }
      return;
    }
    try {
      return await AsyncStorage.removeItem(key);
    } catch (error) {
      console.warn("AsyncStorage removeItem error:", error);
    }
  },
};

export interface Language {
  code: string;
  name: string;
  nativeName: string;
}

export const languages: Language[] = [
  { code: "en", name: "English", nativeName: "English" },
  { code: "fr", name: "French", nativeName: "FranÃ§ais" },
];

export const translations = {
  en: {
    // Header
    notifications: "Notifications",
    settings: "Settings",

    // Notifications Page
    notificationsTitle: "Notifications",
    noNotifications: "No notifications",
    noNotificationsDescription: "You have no new notifications at this time.",
    markAllAsRead: "Mark all as read",
    clearAll: "Clear all",
    newReservation: "New Reservation",
    reservationCancelled: "Reservation Cancelled",
    reservationConfirmed: "Reservation Confirmed",
    systemUpdate: "System Update",
    timeAgo: "ago",
    justNow: "Just now",
    minutesAgo: "minutes ago",
    hoursAgo: "hours ago",
    daysAgo: "days ago",

    // Navigation
    reservations: "Reservations",
    reservationsText: "reservations",

    // Settings Module
    settingsModule: "Settings",
    help: "Help & Support",
    about: "About",
    historyOrder: "History Order",

    // Profile Page
    profile: "Profile",
    profileTitle: "Profile",
    personalInformation: "Personal Information",
    restaurantName: "Restaurant Name",
    userName: "userName",
    email: "Email",
    phone: "Phone",
    address: "Address",
    language: "Language",
    preferences: "Preferences",
    save: "Save",
    restaurantNameRequired:"Restaurant name is required",
    userNameRequired:"user name is required",
    emailInvalid:"Email is invalid",
    phoneRequired:"Phone is required",
    addressRequired:"Address is required",
    phoneInvalid:"Phone is invalid",

    // Reservation Settings
    reservationSettings: "Reservation Settings",
    acceptReservations: "Accept Reservations",
    allowCustomersBookOnline: "Allow customers to book tables online",
    businessHours: "Reservation Manage",
    openingTime: "Opening Time",
    closingTime: "Closing Time",
    timeInterval: "Time Interval",
    maxReservationsPerSlot: "Max Reservations per Slot",
    maxReservationsDescription:
      "Maximum number of reservations allowed for each time slot",
    reservationsUnit: "reservations",
    availableTimeSlots: "Available Time Slots",
    active: "active",
    partySizeLimits: "Party Size Limits",
    minimumGuests: "Minimum Guests",
    maximumGuests: "Maximum Guests",
    bookingRules: "Booking Rules",
    maxAdvanceBookingDays: "Max advance booking (days)",
    minAdvanceNoticeHours: "Min advance notice (hours)",
    saveSuccess:'Save success',
    startTimeAfterEndTime:'Start time must be before end time',
    endTimeBeforeStartTime:'End time must be after start time',

    // Reservation Module
    todaysReservations: "Today's Reservations",
    allReservations: "All Reservations",
    pending: "Pending",
    confirmed: "Confirmed",
    completed: "Completed",
    cancelled: "Cancelled",
    accept: "Accept",
    decline: "Reject",
    guests: "guests",
    acceptTip:"Are you sure you want to confirm this reservation?",
    rejectTip:"Are you sure you want to reject this reservation?",
    tip:"Tip",

    // Help & Support
    helpSupport: "Help & Support",
    helpSupportDescription:
      "Get help and support for your restaurant management",
    quickHelp: "Quick Help",
    liveChat: "Live Chat",
    liveChatDescription: "Chat with our support team",
    frequentlyAskedQuestions: "Frequently Asked Questions",
    howToAcceptReservation: "How do I accept or decline a reservation?",
    howToAcceptReservationAnswer:
      "Tap on any reservation from the list to view details, then use the Accept or Decline buttons at the bottom.",
    howToManageTables: "How do I manage my table settings?",
    howToManageTablesAnswer:
      "Go to Settings > Table Settings to configure your reservation preferences, business hours, and table capacity.",
    howToChangeLanguage: "How do I change the app language?",
    howToChangeLanguageAnswer:
      "Go to Profile settings and select your preferred language from the Language dropdown menu.",
    howToSetBusinessHours: "How do I set my business hours?",
    howToSetBusinessHoursAnswer:
      "In Table Settings, you can set your opening and closing times, and configure available time slots for reservations.",
    contactSupport: "Contact Support",
    emailSupport: "Email Support",
    phoneSupport: "Phone Support",
    sendEmail: "Send Email",
    callNow: "Call Now",
    supportHours: "Support Hours:",
    supportHoursDetails:
      "Monday - Friday: 9:00 AM - 6:00 PM (EST)\nWeekend: 10:00 AM - 4:00 PM (EST)",
    appInformation: "App Information",
    version: "Version",
    lastUpdated: "Last Updated",
    buildNumber: "Build Number",

    // Common
    back: "Back",
    cancel: "Cancel",
    submit: "Submit",
    edit: "Edit",
    delete: "Delete",
    confirm: "Confirm",

    // Login & Authentication
    signIn: "Sign In",
    signInDescription: "Welcome back to NEO",
    loginEmail: "Email",
    emailPlaceholder: "Enter your email address",
    password: "Password",
    passwordPlaceholder: "Enter your password",
    forgotPassword: "Forgot password?",
    signingIn: "Signing in...",
    orContinueWith: "or continue with",
    continueWithGoogle: "Continue with Google",
    dontHaveAccount: "Don't have an account?",
    signUp: "Sign up",
    demoCredentials: "Demo Credentials:",
    signOut: "Sign Out",
    signOutDescription: "Sign out of your account",
    
    // Forgot Password
    forgotPasswordTitle: "Forgot Password",
    forgotPasswordSubtitle: "Enter your email address and we'll send you a verification code to reset your password",
    sendVerificationCode: "Send Verification Code",
    verificationCodeTitle: "Enter Verification Code",
    verificationCodeSubtitle: "We've sent a 6-digit verification code to",
    enterVerificationCode: "Enter verification code",
    resendCode: "Resend Code",
    resendCodeIn: "Resend code in",
    seconds: "seconds",
    verifyCode: "Verify Code",
    resetPasswordTitle: "Reset Password",
    resetPasswordSubtitle: "Create a new password for your account",
    newPassword: "New Password",
    confirmNewPassword: "Confirm New Password",
    resetPassword: "Reset Password",
    passwordResetSuccess: "Password Reset Successful",
    passwordResetSuccessMessage: "Your password has been successfully reset. You can now sign in with your new password.",
    backToSignIn: "Back to Sign In",
    codeExpired: "Verification code has expired",
    invalidCode: "Invalid verification code",
    emailNotFound: "Email address not found",
    passwordResetFailed: "Password reset failed. Please try again.",

    // Success messages
    settingsSaved: "Settings saved successfully!",
    profileUpdated: "Profile updated successfully!",
    success: "Success",
    error: "Error",
    // Model
    modelCancel: "Cancel",
    modelOk: "OK",
    
    // SearchBar
    searchReservations: "Search reservations...",
    filterByDate: "Filter by date",
    
    // Common UI text
    reservationManagement: "Reservation Management",
    setOpeningClosingTimes: "Set opening and closing times",
    currentlyOpen: "Currently Open",
    manageProfilePreferences: "Manage your profile and preferences",
    manageRestaurantSettings: "Manage your restaurant settings",
    getHelpContactSupport: "Get help and contact support",
    autoConfirm: "Auto Confirm",
    darkMode: "Dark Mode",
    
    // Time and date
    today: "Today",
    tomorrow: "Tomorrow",
    
    // Reservation details
    reservation: "reservation",
    
    // Status and actions
    open: "Open",
    close: "Close",
    
    // Validation messages
    languageRequired: "Language is required",
    emailRequired: "Please enter a valid email",
    passwordMinLength: "Password must be at least 6 characters",
    passwordMaxLength: "Password cannot exceed 20 characters",
    passwordMustContainLetter: "Password must contain letters",
    passwordMustContainNumber: "Password must contain numbers",
    passwordMustContainSpecialChar: "Password must contain special characters",
    codeMinLength: "Verification code must be at least 6 digits",
    codeMaxLength: "Verification code cannot exceed 6 digits",
    passwordMismatch: "Passwords do not match",
    
    // Time Picker
    selectTime: "Select Time",
    selectedTime: "Selected Time",
    
    // Guest Count Validation
    minGuestsCannotExceedMaxGuests: "Minimum guests cannot exceed maximum guests",
    maxGuestsCannotBeLessThanMinGuests: "Maximum guests cannot be less than minimum guests",
    
    // Date formats
    manageRestaurantReservations: "Manage your restaurant reservations",
    
    // Header menu descriptions
    profileDescription: "Manage your profile and preferences",
    settingsDescription: "Manage your restaurant settings",
    helpDescription: "Get help and contact support",
    historyOrderDescription: "View your order history",
    
    // Settings status
    currentStatus: "Currently Open",
  },
  fr: {
    // Header
    notifications: "Notifications",
    settings: "ParamÃ¨tres",

    // Notifications Page
    notificationsTitle: "Notifications",
    noNotifications: "Aucune notification",
    noNotificationsDescription:
      "Vous n'avez aucune nouvelle notification pour le moment.",
    markAllAsRead: "Tout marquer comme lu",
    clearAll: "Tout effacer",
    newReservation: "Nouvelle RÃ©servation",
    reservationCancelled: "RÃ©servation AnnulÃ©e",
    reservationConfirmed: "RÃ©servation ConfirmÃ©e",
    systemUpdate: "Mise Ã  Jour SystÃ¨me",
    timeAgo: "il y a",
    justNow: "Ã l'instant",
    minutesAgo: "minutes",
    hoursAgo: "heures",
    daysAgo: "jours",

    // Navigation
    reservations: "RÃ©servations",
    reservationsText: "rÃ©servation",

    // Settings Module
    settingsModule: "ParamÃ¨tres",
    help: "Aide et Support",
    about: "Ã propos",
    historyOrder: "Historique des Commandes",

    // Profile Page
    profile: "Profil",
    profileTitle: "Profil",
    personalInformation: "Informations Personnelles",
    restaurantName: "Nom du Restaurant",
    userName: "Nom d'utilisateur",
    email: "Courriel",
    phone: "TÃ©lÃ©phone",
    address: "Adresse",
    language: "Langue",
    preferences: "PrÃ©fÃ©rences",
    save: "Enregistrer",
    restaurantNameRequired:"Le nom du restaurant est requis",
    userNameRequired:"Le nom d'utilisateur est requis",
    emailInvalid:"L'email est invalide",
    phoneRequired:"Le tÃ©lÃ©phone est requis",
    phoneInvalid:"Le tÃ©lÃ©phone est invalide",
    addressRequired:"L'adresse est requise",

    // Reservation Settings
    reservationSettings: "ParamÃ¨tres de RÃ©servation",
    acceptReservations: "Accepter les RÃ©servations",
    allowCustomersBookOnline:
      "Permettre aux clients de rÃ©server des tables en ligne",
    businessHours: "Gestion des Horaires d'Ouverture",
    openingTime: "Heure d'Ouverture",
    closingTime: "Heure de Fermeture",
    timeInterval: "Intervalle de Temps",
    maxReservationsPerSlot: "Max RÃ©servations par CrÃ©neau",
    maxReservationsDescription:
      "Nombre maximum de rÃ©servations autorisÃ©es pour chaque crÃ©neau horaire",
    reservationsUnit: "rÃ©servations",
    availableTimeSlots: "CrÃ©neaux Horaires Disponibles",
    active: "actif",
    partySizeLimits: "Limites de Taille de Groupe",
    minimumGuests: "InvitÃ©s Minimum",
    maximumGuests: "InvitÃ©s Maximum",
    bookingRules: "RÃ¨gles de RÃ©servation",
    maxAdvanceBookingDays: "RÃ©servation Ã  l'avance max (jours)",
    minAdvanceNoticeHours: "PrÃ©avis minimum (heures)",
    saveSuccess:'Ã©conomiser le succÃ¨s',
    startTimeAfterEndTime:'Heure de dÃ©but doit Ãªtre avant l\'heure de fermeture',
    endTimeBeforeStartTime:'Heure de fin doit Ãªtre aprÃ¨s l\'heure d\'ouverture',

    // Reservation Module
    todaysReservations: "RÃ©servations d'Aujourd'hui",
    allReservations: "Toutes les RÃ©servations",
    pending: "En attente",
    confirmed: "ConfirmÃ©",
    completed: "TerminÃ©",
    cancelled: "AnnulÃ©",
    accept: "Accepter",
    decline: "Refuser",
    guests: "invitÃ©s",
    acceptTip:"Ãtes-vous sÃ»r de vouloir confirmer cette rÃ©servation ?",
    rejectTip:"Ãtes-vous sÃ»r de vouloir rejeter cette rÃ©servation ?",
    tip:"Conseil",

    // Help & Support
    helpSupport: "Aide et Support",
    helpSupportDescription:
      "Obtenez de l'aide et du support pour la gestion de votre restaurant",
    quickHelp: "Aide Rapide",
    liveChat: "Chat en Direct",
    liveChatDescription: "Chattez avec notre Ã©quipe de support",
    frequentlyAskedQuestions: "Questions FrÃ©quemment PosÃ©es",
    howToAcceptReservation: "Comment accepter ou refuser une rÃ©servation ?",
    howToAcceptReservationAnswer:
      "Appuyez sur n'importe quelle rÃ©servation de la liste pour voir les dÃ©tails, puis utilisez les boutons Accepter ou Refuser en bas.",
    howToManageTables: "Comment gÃ©rer les paramÃ¨tres de mes tables ?",
    howToManageTablesAnswer:
      "Allez dans ParamÃ¨tres > ParamÃ¨tres des Tables pour configurer vos prÃ©fÃ©rences de rÃ©servation, heures d'ouverture et capacitÃ© des tables.",
    howToChangeLanguage: "Comment changer la langue de l'application ?",
    howToChangeLanguageAnswer:
      "Allez dans les paramÃ¨tres de Profil et sÃ©lectionnez votre langue prÃ©fÃ©rÃ©e dans le menu dÃ©roulant Langue.",
    howToSetBusinessHours: "Comment dÃ©finir mes heures d'ouverture ?",
    howToSetBusinessHoursAnswer:
      "Dans les ParamÃ¨tres des Tables, vous pouvez dÃ©finir vos heures d'ouverture et de fermeture, et configurer les crÃ©neaux horaires disponibles pour les rÃ©servations.",
    contactSupport: "Contacter le Support",
    emailSupport: "Support par Email",
    phoneSupport: "Support TÃ©lÃ©phonique",
    sendEmail: "Envoyer un Email",
    callNow: "Appeler Maintenant",
    supportHours: "Heures de Support :",
    supportHoursDetails:
      "Lundi - Vendredi : 9h00 - 18h00 (EST)\nWeek-end : 10h00 - 16h00 (EST)",
    appInformation: "Informations de l'Application",
    version: "Version",
    lastUpdated: "DerniÃ¨re Mise Ã  Jour",
    buildNumber: "NumÃ©ro de Build",

    // Common
    back: "Retour",
    cancel: "Annuler",
    submit: "Soumettre",
    edit: "Modifier",
    delete: "Supprimer",
    confirm: "Confirmer",

    // Login & Authentication
    signIn: "Connexion",
    signInDescription: "Bienvenue sur NEO",
    loginEmail: "Courriel",
    emailPlaceholder: "Entrez votre adresse email",
    password: "Mot de passe",
    passwordPlaceholder: "Entrez votre mot de passe",
    forgotPassword: "Mot de passe oubliÃ© ?",
    signingIn: "Connexion en cours...",
    orContinueWith: "ou continuer avec",
    continueWithGoogle: "Continuer avec Google",
    dontHaveAccount: "Vous n'avez pas de compte ?",
    signUp: "S'inscrire",
    demoCredentials: "Identifiants de dÃ©monstration :",
    signOut: "DÃ©connexion",
    signOutDescription: "Se dÃ©connecter de votre compte",
    
    // Forgot Password
    forgotPasswordTitle: "Mot de passe oubliÃ©",
    forgotPasswordSubtitle: "Entrez votre adresse email et nous vous enverrons un code de vÃ©rification pour rÃ©initialiser votre mot de passe",
    sendVerificationCode: "Envoyer le code de vÃ©rification",
    verificationCodeTitle: "Entrer le code de vÃ©rification",
    verificationCodeSubtitle: "Nous avons envoyÃ© un code de vÃ©rification Ã  6 chiffres Ã ",
    enterVerificationCode: "Entrer le code de vÃ©rification",
    resendCode: "Renvoyer le code",
    resendCodeIn: "Renvoyer le code dans",
    seconds: "secondes",
    verifyCode: "VÃ©rifier le code",
    resetPasswordTitle: "RÃ©initialiser le mot de passe",
    resetPasswordSubtitle: "CrÃ©ez un nouveau mot de passe pour votre compte",
    newPassword: "Nouveau mot de passe",
    confirmNewPassword: "Confirmer le nouveau mot de passe",
    resetPassword: "RÃ©initialiser le mot de passe",
    passwordResetSuccess: "RÃ©initialisation du mot de passe rÃ©ussie",
    passwordResetSuccessMessage: "Votre mot de passe a Ã©tÃ© rÃ©initialisÃ© avec succÃ¨s. Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.",
    backToSignIn: "Retour Ã  la connexion",
    codeExpired: "Le code de vÃ©rification a expirÃ©",
    invalidCode: "Code de vÃ©rification invalide",
    emailNotFound: "Adresse email introuvable",
    passwordResetFailed: "Ãchec de la rÃ©initialisation du mot de passe. Veuillez rÃ©essayer.",

    // Success messages
    settingsSaved: "ParamÃ¨tres sauvegardÃ©s avec succÃ¨s !",
    profileUpdated: "Profil mis Ã  jour avec succÃ¨s !",
    success: "SuccÃ¨s",
    error: "Erreur",
    // Model
    modelCancel: "Annuler",
    modelOk: "OK",
    
    // SearchBar
    searchReservations: "Rechercher des rÃ©servations...",
    filterByDate: "Filtrer par date",
    
    // Common UI text
    reservationManagement: "Gestion des RÃ©servations",
    setOpeningClosingTimes: "DÃ©finir les heures d'ouverture et de fermeture",
    currentlyOpen: "Actuellement Ouvert",
    manageProfilePreferences: "GÃ©rer votre profil et prÃ©fÃ©rences",
    manageRestaurantSettings: "GÃ©rer les paramÃ¨tres de votre restaurant",
    getHelpContactSupport: "Obtenir de l'aide et contacter le support",
    autoConfirm: "Confirmation Automatique",
    darkMode: "Mode Sombre",
    
    // Time and date
    today: "Aujourd'hui",
    tomorrow: "Demain",
    
    // Reservation details
    reservation: "rÃ©servation",
    
    // Status and actions
    open: "Ouvert",
    close: "FermÃ©",
    
    // Validation messages
    languageRequired: "La langue est requise",
    emailRequired: "Veuillez saisir un email valide",
    passwordMinLength: "Le mot de passe doit contenir au moins 6 caractÃ¨res",
    passwordMaxLength: "Le mot de passe ne peut pas dÃ©passer 20 caractÃ¨res",
    passwordMustContainLetter: "Le mot de passe doit contenir des lettres",
    passwordMustContainNumber: "Le mot de passe doit contenir des chiffres",
    passwordMustContainSpecialChar: "Le mot de passe doit contenir des caractÃ¨res spÃ©ciaux",
    codeMinLength: "Le code de vÃ©rification doit contenir au moins 6 chiffres",
    codeMaxLength: "Le code de vÃ©rification ne peut pas dÃ©passer 6 chiffres",
    passwordMismatch: "Les mots de passe ne correspondent pas",
    
    // Time Picker
    selectTime: "SÃ©lectionner l'heure",
    selectedTime: "Heure sÃ©lectionnÃ©e",
    
    // Guest Count Validation
    minGuestsCannotExceedMaxGuests: "Le nombre minimum d'invitÃ©s ne peut pas dÃ©passer le maximum",
    maxGuestsCannotBeLessThanMinGuests: "Le nombre maximum d'invitÃ©s ne peut pas Ãªtre infÃ©rieur au minimum",
    
    // Date formats
    manageRestaurantReservations: "GÃ©rer les rÃ©servations de votre restaurant",
    
    // Header menu descriptions
    profileDescription: "GÃ©rer votre profil et prÃ©fÃ©rences",
    settingsDescription: "GÃ©rer les paramÃ¨tres de votre restaurant",
    helpDescription: "Obtenir de l'aide et contacter le support",
    historyOrderDescription: "Voir l'historique de vos commandes",
    
    // Settings status
    currentStatus: "Actuellement Ouvert",
  },
};

export type TranslationKey = keyof typeof translations.en;

export class I18nService {
  private static instance: I18nService;
  private currentLanguage: string = "en";
  private listeners: (() => void)[] = [];
  private initialized: boolean = false;

  private constructor() {
    this.loadLanguage();
  }

  static getInstance(): I18nService {
    if (!I18nService.instance) {
      I18nService.instance = new I18nService();
    }
    return I18nService.instance;
  }

  private async loadLanguage(): Promise<void> {
    try {
      const savedLanguage = await storage.getItem("language");
      if (savedLanguage && savedLanguage in translations) {
        this.currentLanguage = savedLanguage;
      }
      this.initialized = true;
      this.notifyListeners();
    } catch (error) {
      console.error("Error loading language from storage:", error);
      this.initialized = true;
      this.notifyListeners();
    }
  }

  getCurrentLanguage(): string {
    return this.currentLanguage;
  }

  async setLanguage(language: string): Promise<void> {
    if (language in translations) {
      this.currentLanguage = language;
      try {
        await storage.setItem("language", language);
      } catch (error) {
        console.error("Error saving language to storage:", error);
      }
      this.notifyListeners();
    }
  }

  t(key: TranslationKey): string {
    try {
      const translation =
        translations[this.currentLanguage as keyof typeof translations];
      if (!translation) {
        console.warn(
          `Translation not found for language: ${this.currentLanguage}`
        );
        return translations.en[key] || key;
      }
      return translation[key] || translations.en[key] || key;
    } catch (error) {
      console.error("Translation error:", error, "for key:", key);
      return key;
    }
  }

  subscribe(callback: () => void): () => void {
    this.listeners.push(callback);
    return () => {
      this.listeners = this.listeners.filter(
        (listener) => listener !== callback
      );
    };
  }

  private notifyListeners(): void {
    this.listeners.forEach((listener) => listener());
  }

  isInitialized(): boolean {
    return this.initialized;
  }
}

export const i18n = I18nService.getInstance();
